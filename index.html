<script>
const video = document.getElementById("video");
const cameraSelect = document.getElementById("cameraSelect");
const checkBtn = document.getElementById("checkPermissions");
const logEl = document.getElementById("log");

let stream;

const log = (msg) => {
  logEl.textContent += "\n" + msg;
  console.log(msg);
};

async function requestAccessAndListCameras() {
  try {
    log("ğŸ” Kamera-Zugriff wird angefragt...");
    stream = await navigator.mediaDevices.getUserMedia({ video: true });
    video.srcObject = stream;
    log("âœ… Kamera-Stream gestartet");

    const devices = await navigator.mediaDevices.enumerateDevices();
    const cams = devices.filter(d => d.kind === "videoinput");

    cameraSelect.innerHTML = "";
    cams.forEach((cam, i) => {
      const opt = document.createElement("option");
      opt.value = cam.deviceId;
      opt.text = cam.label || `Kamera ${i + 1}`;
      cameraSelect.appendChild(opt);
    });

    log(`ğŸ“· ${cams.length} Kamera(s) gefunden`);
  } catch (err) {
    log("âŒ Fehler beim Kamerazugriff: " + err.message);
  }
}

cameraSelect.addEventListener("change", async () => {
  const deviceId = cameraSelect.value;
  if (stream) stream.getTracks().forEach(track => track.stop());

  try {
    stream = await navigator.mediaDevices.getUserMedia({ video: { deviceId: { exact: deviceId } } });
    video.srcObject = stream;
    log("ğŸ”„ Kamera gewechselt");
  } catch (err) {
    log("âŒ Fehler beim Kamerawechsel: " + err.message);
  }
});

checkBtn.addEventListener("click", requestAccessAndListCameras);
</script>
